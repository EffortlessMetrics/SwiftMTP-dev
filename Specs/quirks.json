{
  "$schema": "./quirks.schema.json",
  "schemaVersion": "1.0.0",
  "version": 1,
  "entries": [
    {
      "id": "xiaomi-mi-note-2-ff10",
      "match": {
        "vid": "0x2717",
        "pid": "0xff10",
        "deviceInfoRegex": ".*Mi Note 2.*",
        "iface": {
          "class": "0x06",
          "subclass": "0x01",
          "protocol": "0x01"
        },
        "endpoints": {
          "in": "0x81",
          "out": "0x01",
          "evt": "0x82"
        }
      },
      "tuning": {
        "maxChunkBytes": 2097152,
        "handshakeTimeoutMs": 6000,
        "ioTimeoutMs": 15000,
        "inactivityTimeoutMs": 8000,
        "overallDeadlineMs": 120000,
        "stabilizeMs": 400,
        "resetOnOpen": false,
        "eventPumpDelayMs": 0
      },
      "hooks": [
        {
          "phase": "postOpenSession",
          "delayMs": 400
        },
        {
          "phase": "beforeGetStorageIDs",
          "busyBackoff": {
            "retries": 3,
            "baseMs": 200,
            "jitterPct": 0.2
          }
        }
      ],
      "ops": {
        "supportsGetPartialObject64": true,
        "supportsSendPartialObject": true,
        "preferGetObjectPropList": false,
        "disableWriteResume": false
      },
      "confidence": "high",
      "status": "stable",
      "notes": [
        "Requires 250-500 ms stabilization after OpenSession.",
        "Prefer direct USB port; keep screen unlocked.",
        "Back off on DEVICE_BUSY for early storage ops."
      ],
      "provenance": {
        "author": "Steven Zimmerman",
        "date": "2025-01-09",
        "commit": "<current-commit>"
      },
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "writeToSubfolderOnly": true
      }
    },
    {
      "id": "xiaomi-mi-note-2-ff40",
      "match": {
        "vid": "0x2717",
        "pid": "0xff40",
        "deviceInfoRegex": ".*Mi Note 2.*",
        "iface": {
          "class": "0xff"
        },
        "endpoints": {
          "in": "0x81",
          "out": "0x01",
          "evt": "0x82"
        }
      },
      "tuning": {
        "maxChunkBytes": 2097152,
        "handshakeTimeoutMs": 6000,
        "ioTimeoutMs": 15000,
        "inactivityTimeoutMs": 8000,
        "overallDeadlineMs": 120000,
        "stabilizeMs": 400,
        "resetOnOpen": false,
        "eventPumpDelayMs": 0
      },
      "ops": {
        "supportsGetPartialObject64": true,
        "supportsSendPartialObject": true,
        "preferGetObjectPropList": false,
        "disableWriteResume": false
      },
      "behaviorLimitations": [
        {
          "operation": "SendObject",
          "errorCode": "0x201D",
          "description": "Cannot write to storage root (0x00000000). SendObject fails with InvalidParameter when parent handle is 0.",
          "workaround": "Use first available folder as parent container instead of storage root."
        }
      ],
      "notes": [
        "Same tuning as ff10 variant with vendor-specific (0xff) MTP interface matching.",
        "Requires 250-500 ms stabilization after OpenSession.",
        "Prefer direct USB port; keep screen unlocked."
      ],
      "provenance": {
        "author": "Steven Zimmerman",
        "date": "2025-01-09",
        "commit": "<current-commit>",
        "artifacts": {
          "probe": "probes/mi-note2-probe.txt",
          "bench100M": "Docs/benchmarks/csv/mi-note2-100m.csv",
          "bench1G": "Docs/benchmarks/csv/mi-note2-1g.csv"
        }
      },
      "status": "stable",
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "writeToSubfolderOnly": false,
        "preferredWriteFolder": "Download",
        "emptyDatesInSendObject": true
      },
      "confidence": "high"
    },
    {
      "id": "samsung-android-6860",
      "match": {
        "vid": "0x04e8",
        "pid": "0x6860",
        "deviceInfoRegex": ".*SAMSUNG.*",
        "iface": {
          "class": "0xff"
        },
        "endpoints": {
          "in": "0x81",
          "out": "0x01",
          "evt": "0x82"
        }
      },
      "tuning": {
        "maxChunkBytes": 1048576,
        "handshakeTimeoutMs": 8000,
        "ioTimeoutMs": 12000,
        "inactivityTimeoutMs": 10000,
        "overallDeadlineMs": 120000,
        "stabilizeMs": 500,
        "resetOnOpen": true,
        "requiresKernelDetach": true,
        "alternateInterfaceSelection": true,
        "postClaimStabilizeMs": 500
      },
      "hooks": [
        {
          "phase": "postOpenSession",
          "delayMs": 500
        },
        {
          "phase": "beforeGetStorageIDs",
          "busyBackoff": {
            "retries": 5,
            "baseMs": 400,
            "jitterPct": 0.25
          }
        }
      ],
      "ops": {
        "supportsGetPartialObject64": true,
        "supportsSendPartialObject": false,
        "preferGetObjectPropList": true,
        "disableWriteResume": true
      },
      "probeLadder": {
        "enabled": true,
        "steps": [
          {
            "method": "sessionlessGetDeviceInfo",
            "timeoutMs": 5000
          },
          {
            "method": "openSessionThenGetDeviceInfo",
            "timeoutMs": 5000
          },
          {
            "method": "getStorageIDs",
            "timeoutMs": 5000
          }
        ]
      },
      "warnings": [
        {
          "condition": "noInterfaceResponded",
          "message": "Samsung device did not respond on expected MTP interface. Trying alternate interfaces.",
          "severity": "warning"
        }
      ],
      "confidence": "medium",
      "status": "experimental",
      "notes": [
        "Vendor-specific interface class (0xff) discovered by shared MTP heuristic.",
        "Increased post-claim stabilize to 500ms for Samsung MTP stack readiness.",
        "Probe ladder tries sessionless GetDeviceInfo, then OpenSession+GetDeviceInfo, then GetStorageIDs.",
        "Added beforeGetStorageIDs hook with busy-backoff to wait for storage readiness.",
        "Storage enumeration now retries up to 5 times with exponential backoff (400ms to 5s).",
        "Read validation is reliable; write smoke remains best-effort."
      ],
      "provenance": {
        "author": "Steven Zimmerman",
        "date": "2026-02-10"
      },
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "writeToSubfolderOnly": false
      }
    },
    {
      "id": "oneplus-3t-f003",
      "match": {
        "vid": "0x2a70",
        "pid": "0xf003",
        "iface": {
          "class": "0x06",
          "subclass": "0x01",
          "protocol": "0x01"
        },
        "endpoints": {
          "in": "0x81",
          "out": "0x01",
          "evt": "0x82"
        }
      },
      "tuning": {
        "maxChunkBytes": 1048576,
        "handshakeTimeoutMs": 6000,
        "ioTimeoutMs": 8000,
        "inactivityTimeoutMs": 10000,
        "overallDeadlineMs": 120000,
        "stabilizeMs": 200,
        "resetOnOpen": false,
        "skipPTPReset": true,
        "eventPumpDelayMs": 0
      },
      "hooks": [
        {
          "phase": "postOpenSession",
          "delayMs": 200
        }
      ],
      "ops": {
        "supportsGetPartialObject64": true,
        "supportsSendPartialObject": true,
        "preferGetObjectPropList": true,
        "supportsEvents": true,
        "disableWriteResume": false
      },
      "behaviorLimitations": [
        {
          "operation": "SendObject",
          "errorCode": "0x201D",
          "description": "Cannot write to storage root (0x00000000). SendObject fails with InvalidParameter when parent handle is 0.",
          "workaround": "Use first available folder as parent container instead of storage root."
        }
      ],
      "confidence": "high",
      "status": "stable",
      "notes": [
        "OnePlus 3T (ONEPLUS A3010) probes in ~115 ms; no resetOnOpen needed with new claim sequence.",
        "PTP Device Reset (0x66) NOT supported (rc=-9, LIBUSB_ERROR_PIPE); skipPTPReset=true.",
        "Session opens instantly (0 ms), no retry needed.",
        "SendObject returns 0x201D (InvalidParameter) when writing to storage root; use a subfolder as parent.",
        "Second USB interface is Mass Storage (class=0x08); ignored by MTP transport.",
        "Fallback strategies: enum=propList5, read=partial64, write=partial."
      ],
      "provenance": {
        "author": "Steven Zimmerman",
        "date": "2026-02-07",
        "artifacts": {
          "probe": "Docs/benchmarks/probes/oneplus3t-probe.txt",
          "usbDump": "Docs/benchmarks/probes/oneplus3t-usb-dump.txt"
        }
      },
      "flags": {
        "writeToSubfolderOnly": true,
        "resetReopenOnOpenSessionIOError": true
      }
    },
    {
      "id": "google-pixel-7-4ee1",
      "match": {
        "vid": "0x18d1",
        "pid": "0x4ee1",
        "iface": {
          "class": "0x06",
          "subclass": "0x01",
          "protocol": "0x01"
        },
        "endpoints": {
          "in": "0x81",
          "out": "0x01",
          "evt": "0x82"
        }
      },
      "tuning": {
        "maxChunkBytes": 2097152,
        "handshakeTimeoutMs": 20000,
        "ioTimeoutMs": 30000,
        "inactivityTimeoutMs": 10000,
        "overallDeadlineMs": 180000,
        "stabilizeMs": 3000,
        "postClaimStabilizeMs": 3000,
        "resetOnOpen": false,
        "requiresKernelDetach": true,
        "forceConfigurationNumber": 1,
        "forceAltSetting": 0
      },
      "warnings": [
        {
          "condition": "probeFailedNoInterfaces",
          "message": "Pixel 7 not exposing MTP interfaces. Check: 1) USB mode is MTP (adb shell getprop sys.usb.config), 2) Computer is trusted (check Pixel prompt), 3) USB debugging enabled in Developer Options.",
          "severity": "error"
        },
        {
          "condition": "chromeWebUSBDetected",
          "message": "Chrome/WebUSB may be holding this device. Quit all Chromium-based browsers (Chrome, Edge, Brave) and unplug/replug the device.",
          "severity": "warning"
        }
      ],
      "behaviorLimitations": [
        {
          "operation": "All MTP operations",
          "errorCode": "LIBUSB_ERROR_TIMEOUT (-7)",
          "description": "Pixel 7 Still Image class (0x06) interface is not responding. This is a macOS/Pixel USB stack issue where the device is not exposing MTP interfaces properly. See Docs/SwiftMTP.docc/macOS26.md for troubleshooting.",
          "workaround": "Ensure Pixel is in MTP mode with USB debugging enabled and computer is trusted. Try PTP mode as alternative."
        }
      ],
      "confidence": "low",
      "status": "experimental",
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "resetReopenOnOpenSessionIOError": true,
        "transactionIdResetsOnSession": true
      },
      "notes": [
        "ROOT CAUSE: Device is not exposing MTP interfaces to macOS (no IOUSBInterface children in ioreg).",
        "Symptom: Claim succeeds but bulk writes timeout (sent=0/12, rc=-7).",
        "This is a Pixel 7 / macOS 26.2 USB stack incompatibility, NOT a SwiftMTP bug.",
        "Required: Enable Developer Options, USB debugging, and trust the computer on the Pixel.",
        "Alternative: Try PTP mode (adb usb ptp) instead of MTP.",
        "Samsung and Xiaomi devices work correctly; Pixel 7 Still Image class is not being exposed."
      ],
      "provenance": {
        "author": "Steven Zimmerman",
        "date": "2026-02-12",
        "artifacts": {
          "ioregDump": "Docs/benchmarks/pixel7/ioreg-dump.txt",
          "debugReport": "Docs/pixel7-usb-debug-report.md",
          "macOS26Doc": "Docs/SwiftMTP.docc/macOS26.md"
        }
      },
      "ops": {
        "supportsGetPartialObject64": false,
        "supportsSendPartialObject": false,
        "preferGetObjectPropList": false,
        "disableWriteResume": false
      }
    },
    {
      "id": "canon-eos-rebel-3139",
      "match": {
        "vid": "0x04a9",
        "pid": "0x3139",
        "deviceInfoRegex": ".*Canon.*EOS.*",
        "iface": {
          "class": "0x06",
          "subclass": "0x01",
          "protocol": "0x01"
        }
      },
      "tuning": {
        "maxChunkBytes": 1048576,
        "handshakeTimeoutMs": 8000,
        "ioTimeoutMs": 30000,
        "inactivityTimeoutMs": 15000,
        "overallDeadlineMs": 180000,
        "stabilizeMs": 200,
        "resetOnOpen": false,
        "eventPumpDelayMs": 50
      },
      "hooks": [
        {
          "phase": "postOpenSession",
          "delayMs": 200
        }
      ],
      "ops": {
        "supportsGetPartialObject64": false,
        "supportsSendPartialObject": false,
        "preferGetObjectPropList": false,
        "disableWriteResume": true,
        "skipGetObjectPropValue": false
      },
      "confidence": "medium",
      "status": "experimental",
      "notes": [
        "Canon EOS cameras use PTP over USB with PTPIP-style initialization.",
        "Large RAW files (>20 MB) may require extended ioTimeoutMs.",
        "Camera must be in PTP/MTP mode (not PC Connection mode).",
        "Event pump needed for capture events (0x4001 ObjectAdded).",
        "Battery level can be read via GetDevicePropValue (0xD002)."
      ],
      "provenance": {
        "author": "SwiftMTP Contributors",
        "date": "2025-02-25",
        "commit": "<pending>"
      },
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "writeToSubfolderOnly": false,
        "cameraClass": true
      }
    },
    {
      "id": "nikon-dslr-0410",
      "match": {
        "vid": "0x04b0",
        "pid": "0x0410",
        "deviceInfoRegex": ".*Nikon.*",
        "iface": {
          "class": "0x06",
          "subclass": "0x01",
          "protocol": "0x01"
        }
      },
      "tuning": {
        "maxChunkBytes": 1048576,
        "handshakeTimeoutMs": 8000,
        "ioTimeoutMs": 30000,
        "inactivityTimeoutMs": 15000,
        "overallDeadlineMs": 180000,
        "stabilizeMs": 300,
        "resetOnOpen": false,
        "eventPumpDelayMs": 100
      },
      "hooks": [
        {
          "phase": "postOpenSession",
          "delayMs": 300
        }
      ],
      "ops": {
        "supportsGetPartialObject64": false,
        "supportsSendPartialObject": false,
        "preferGetObjectPropList": false,
        "disableWriteResume": true,
        "skipGetObjectPropValue": false
      },
      "confidence": "medium",
      "status": "experimental",
      "notes": [
        "Nikon D-series cameras use PTP over USB.",
        "Camera must be in MTP/PTP mode via Settings > USB Options.",
        "Liveview and capture events require Nikon vendor extensions (0x9xxx).",
        "NEF raw files are large (15-30 MB); extend ioTimeoutMs if needed.",
        "Some Nikon bodies support GetObjectSizeU64 via property 0xDC04."
      ],
      "provenance": {
        "author": "SwiftMTP Contributors",
        "date": "2025-02-25",
        "commit": "<pending>"
      },
      "flags": {
        "requiresKernelDetach": true,
        "resetOnOpen": false,
        "writeToSubfolderOnly": false,
        "cameraClass": true
      }
    }
  ]
}
